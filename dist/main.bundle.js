(()=>{"use strict";class e{constructor(e=[],t=[]){this.shape=e,this.content=t,this.tableau=[[]]}rowBump(e){for(;this.content.length<=e;)this.content.push(0);if(++this.content[e],0==this.tableau[0].length)return this.tableau[0].push(e),this.shape.push(1),[0,0];let t=this.tableau[0].length-1;if(this.tableau[0][t]<=e)return this.tableau[0].push(e),++this.shape[0],[0,t+1];let n=e;for(let e=0;e<this.tableau.length;++e){let t=this.tableau[e].length-1;if(n>=this.tableau[e][t])return this.tableau[e].push(n),++this.shape[e],[e,t+1];for(--t;t>=-1;--t)if(-1==t||n>=this.tableau[e][t]){let l=this.tableau[e][t+1];this.tableau[e][t+1]=n,n=l;break}}return this.tableau.push([n]),this.shape.push(1),[this.tableau.length-1,0]}addBoxAt(e,t=0){let n=e[0],l=e[1];this.tableau.length<n?console.error("can't add box"):this.tableau.length==n&&(this.tableau.push([]),this.shape.push(1)),this.tableau[n].length<l?console.error("can't add box"):this.tableau[n].length==l&&(this.tableau[n].push(t),++this.shape[n])}}class t{constructor(e,t){this.table=this.createNbyM(e,t,!0),this.rows=e,this.columns=t}createNbyM(e,t,n=!1){let l=[];for(let n=0;n<e;++n)l.push(Array.from({length:t},(()=>0)));if(!n)for(let e=0;e<this.table.length;++e)for(let t=0;t<this.table[0].length;++t)l[e][t]=this.table[e][t];return l}addRow(){this.table=this.createNbyM(this.rows+1,this.columns),++this.rows}addColumn(){this.table=this.createNbyM(this.rows,this.columns+1),++this.columns}toHtml(){let e=document.createElement("table");e.classList.add("matrix");const t=this.table[0].length,n=this.table.length;for(let l=0;l<n;++l){let n=document.createElement("tr");for(let e=0;e<t;++e){let t=document.createElement("td");t.classList.add("ct"),t.innerHTML=this.table[l][e],n.appendChild(t)}e.appendChild(n)}return e}printTable(){console.log(this.table)}increment(e,t){++this.table[e][t]}decrement(e,t){--this.table[e][t]}semistandardTableauxFromCT(){let t=this.compute2dArray(),n=new e,l=new e;for(let e=0;e<t.length;++e){let s=n.rowBump(t[e][0]);l.addBoxAt(s,t[e][1])}return[n,l]}compute2dArray(){let e=[];for(let t=0;t<this.table.length;++t)for(let n=0;n<this.table[0].length;++n)for(let l=0;l<this.table[t][n];++l)e.push([t+1,n+1]);return e.sort(((e,t)=>e[1]-t[1])),e}computeRowSums(){let e=[];for(let t=0;t<this.table.length;++t)e.push(this.table[t].reduce(((e,t)=>e+t),0));return e}computeColSums(){let e=[];for(let t=0;t<this.table[0].length;++t){let n=0;for(let e=0;e<this.table.length;++e)n+=this.table[e][t];e.push(n)}return e}}function n(e,t){for(let n=t.length;n<e.length;++n)t.push(0)}(new class{constructor(){this.contingencyTable=new t(3,3)}start(){this.initializeEventListeners(),this.updateRowColSums()}hideTableauxHeaders(){let e=document.getElementsByClassName("vis-when-rsk");for(let t=0;t<e.length;++t)e[t].style.visibility="hidden"}showTableauxHeaders(){let e=document.getElementsByClassName("vis-when-rsk");for(let t=0;t<e.length;++t)e[t].style.visibility="visible"}incrementCell(e,t){let n=parseInt(e.innerHTML);e.innerHTML=n+1;let l=t[0],s=t[1];this.contingencyTable.increment(l,s)}decrementCell(e,t){let n=parseInt(e.innerHTML);if(n>0){e.innerHTML=n-1;let l=t[0],s=t[1];this.contingencyTable.decrement(l,s)}else console.warn("Only positive integers allowed!")}computeRSKAndAppendHtmlToSite(){let[e,t]=this.contingencyTable.semistandardTableauxFromCT();console.log(e.shape),0===e.shape.length?this.hideTableauxHeaders():this.showTableauxHeaders();let n=document.getElementById("tableauP"),l=document.getElementById("tableauQ");n.innerHTML="",l.innerHTML="";for(let s=0;s<e.tableau.length;++s){let a=document.createElement("tr"),i=document.createElement("tr");for(let n=0;n<e.tableau[s].length;++n){let l=document.createElement("td");l.innerHTML=e.tableau[s][n],l.classList.add("ct"),a.appendChild(l);let h=document.createElement("td");h.innerHTML=t.tableau[s][n],h.classList.add("ct"),i.appendChild(h)}n.appendChild(a),l.appendChild(i)}}addTableIncrementListeners(){let e=document.getElementsByClassName("ct"),t=this.contingencyTable.columns;for(let n=0;n<e.length;++n){let l=[Math.floor(n/t),n%t];e[n].addEventListener("click",(()=>{this.incrementCell(e[n],l),this.computeRSKAndAppendHtmlToSite(),this.updateRowColSums()})),e[n].addEventListener("contextmenu",(t=>{t.preventDefault(),this.decrementCell(e[n],l),this.computeRSKAndAppendHtmlToSite(),this.updateRowColSums()}))}}updateRowColSums(){const e=this.contingencyTable.computeRowSums();document.getElementById("row-sums-distr").innerHTML=JSON.stringify(e);const t=this.contingencyTable.computeColSums();document.getElementById("col-sums-distr").innerHTML=JSON.stringify(t);const l=function(e,t){e.length>t.length?n(e,t):t.length>e.length&&n(t,e);const l=e.map(((e,n)=>e-t[n]));let s=0;for(let e=1;e<l.length;++e){let t=l.slice(0,e).reduce(((e,t)=>e+t));s+=Math.abs(t)}return s}(e,t);document.getElementById("distr-emd").innerHTML=l}initializeEventListeners(){this.addTableIncrementListeners(),document.getElementById("btn-add-row").addEventListener("click",(()=>{this.contingencyTable.addRow();const e=this.contingencyTable.toHtml();let t=document.getElementById("matrix-wrapper");t.innerHTML="",t.appendChild(e),this.addTableIncrementListeners()})),document.getElementById("btn-add-col").addEventListener("click",(()=>{this.contingencyTable.addColumn();const e=this.contingencyTable.toHtml();let t=document.getElementById("matrix-wrapper");t.innerHTML="",t.appendChild(e),this.addTableIncrementListeners()}))}}).start()})();